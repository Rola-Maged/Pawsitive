import chalk from 'chalk';

import { FOLDERS_SHOULD_BE_EXCLUDED } from '../constants.js';

import type { CloudConfiguration } from './load-configuration.js';

/**
 * Check if there is AdminJS package in dependencies
 * @param packageJson
 */
const validateConfiguration = (
  configuration: CloudConfiguration,
): boolean => {
  console.log(chalk.blueBright('Validating...'));

  const { include = [] } = configuration;
  const filesDeclarationExists = !!include?.length;
  if (!filesDeclarationExists) {
    console.log(
      chalk.red(
        'There is no \'include\' entry in your configuration file.',
      ),
    );
    process.exit(1);
  }

  FOLDERS_SHOULD_BE_EXCLUDED.forEach((folderName) => {
    if (include?.includes(folderName)) {
      console.log(
        chalk.red(`You must not include ${folderName} in the 'include' entry.`),
      );
      process.exit(0);
    }
  });

  console.log(chalk.green('Validate OK'));
  return true;
};

export default validateConfiguration;
